<!doctype html>
<html>
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Leaks</title>
<style>
:root{--bg:#000;--fg:#7CFC00;--muted:rgba(255,255,255,.06)}
*{box-sizing:border-box}
html,body{height:100%;margin:0;background:var(--bg);color:var(--fg);font-family:monospace}
.top{display:flex;align-items:center;justify-content:space-between;padding:12px 16px;border-bottom:1px solid var(--muted)}
#logo{height:34px}
.menu-btn{background:transparent;border:none;color:var(--fg);cursor:pointer;padding:8px;font-size:18px}
.sidebar{position:fixed;right:-320px;top:0;height:100%;width:320px;background:#050505;border-left:1px solid var(--muted);padding:16px;transition:right .22s;z-index:120;display:flex;flex-direction:column;justify-content:space-between}
.sidebar.show{right:0}
.overlay{position:fixed;inset:0;display:none;background:rgba(0,0,0,.6);z-index:110}
.overlay.show{display:block}
.content{padding:24px;max-width:1000px;margin:0 auto}
.welcome-box{border:1px solid var(--muted);padding:20px;border-radius:8px;background:linear-gradient(180deg, rgba(255,255,255,0.01), transparent)}
#makeThread{background:transparent;border:1px solid var(--fg);color:var(--fg);padding:10px 14px;border-radius:10px;cursor:pointer;font-weight:700}
.thread-form{display:none;flex-direction:column;gap:8px;margin-top:12px}
.thread-form.open{display:flex}
.thread-form input[type="text"], .thread-form textarea{width:100%;padding:10px;border-radius:6px;border:1px solid var(--muted);background:#000;color:var(--fg)}
.thread-form input[type="file"]{color:var(--fg)}
.thread-form .btn{align-self:flex-end;padding:8px 12px;border-radius:8px;border:none;background:var(--fg);color:#000;cursor:pointer}
.threads-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(260px,1fr));gap:12px;margin-top:18px}
.thread-card{border:1px solid var(--muted);padding:12px;border-radius:8px;cursor:pointer;background:rgba(255,255,255,0.01);position:relative;overflow:hidden}
.thread-card h3{margin:0;font-size:16px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
.thread-meta{font-size:12px;color:var(--muted);margin-top:8px}
.modal{position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:rgba(0,0,0,.75);z-index:200;padding:20px}
.modal.show{display:flex}
.modal-box{width:100%;max-width:720px;background:#050505;border-radius:10px;padding:18px;border:1px solid var(--muted);position:relative;max-height:80vh;overflow:auto}
.modal-head{display:flex;justify-content:space-between;align-items:flex-start;gap:8px}
.modal-title{font-size:18px;margin:0}
.three-dot{background:transparent;border:none;color:var(--fg);cursor:pointer;font-size:20px}
.modal-content{margin-top:12px;border-top:1px dashed var(--muted);padding-top:12px;white-space:pre-wrap}
.file-link{display:inline-block;margin-top:12px;padding:8px 10px;border-radius:8px;border:1px solid var(--muted);text-decoration:none;color:var(--fg);background:transparent}
.action-menu{position:absolute;right:12px;top:42px;background:#0a0a0a;border:1px solid var(--muted);padding:6px;border-radius:6px;display:none}
.action-menu.show{display:block}
.action-menu button{display:block;background:transparent;border:none;color:var(--fg);padding:6px 10px;text-align:left;cursor:pointer}
.edit-area{display:flex;flex-direction:column;gap:8px;margin-top:8px}
.small-msg{font-size:13px;color:var(--muted);margin-top:8px}
footer{position:fixed;bottom:0;left:0;right:0;text-align:center;padding:8px 0;border-top:1px solid var(--muted);background:linear-gradient(180deg, transparent, rgba(0,0,0,.2))}
</style>
</head>
<body>
<div class="top">
  <div style="display:flex;align-items:center;gap:12px">
    <img id="logo" src="assets/logo.png" alt="logo">
    <strong>Leaks</strong>
  </div>
  <div>
    <button id="menuBtn" class="menu-btn" type="button">☰</button>
  </div>
</div>
<div id="sidebar" class="sidebar" aria-hidden="true">
  <div>
    <div>Account</div>
    <div style="margin-top:10px">Logged in as <strong id="uname2"></strong></div>
    <div style="margin-top:16px;display:flex;flex-direction:column;gap:8px">
      <a href="/livechat">Live Chat</a>
      <a href="/leaks">Leaks</a>
      <a href="/shop">Shop</a>
    </div>
  </div>
  <div style="margin-top:16px">
    <button id="logout" class="btn" type="button" style="width:100%;padding:10px;border-radius:8px;background:var(--fg);color:#000;border:none;cursor:pointer">Log Out</button>
  </div>
</div>
<div id="overlay" class="overlay"></div>
<div class="content">
  <div class="welcome-box">
    <div style="display:flex;justify-content:space-between;align-items:center">
      <div>
        <h2 style="margin:0">Threads</h2>
        <div class="small-msg" id="statusMsg"></div>
      </div>
      <div>
        <button id="makeThread" type="button">+ New Thread</button>
      </div>
    </div>
    <div id="threadForm" class="thread-form" aria-hidden="true" style="margin-top:12px">
      <input id="threadTitle" type="text" placeholder="Title (required)" />
      <textarea id="threadContent" rows="5" placeholder="Content (required)"></textarea>
      <input id="threadFile" type="file" />
      <div style="display:flex;gap:8px;justify-content:flex-end">
        <button id="cancelThread" type="button" class="btn" style="background:transparent;border:1px solid var(--muted);color:var(--fg)">Cancel</button>
        <button id="submitThread" type="button" class="btn">Post</button>
      </div>
    </div>
    <div class="threads-grid" id="threadsGrid" aria-live="polite"></div>
  </div>
</div>
<div id="modal" class="modal" role="dialog" aria-hidden="true">
  <div class="modal-box" role="document">
    <div class="modal-head">
      <h3 id="modalTitle" class="modal-title"></h3>
      <div style="position:relative">
        <button id="threeDotBtn" class="three-dot" title="Actions" type="button">⋯</button>
        <div id="actionMenu" class="action-menu" role="menu">
          <button id="actionEdit" type="button">Edit</button>
          <button id="actionDelete" type="button">Delete</button>
        </div>
      </div>
    </div>
    <div id="modalMeta" class="small-msg"></div>
    <div id="modalContent" class="modal-content"></div>
    <div id="modalFile"></div>
    <div id="editArea" class="edit-area" style="display:none">
      <textarea id="editTextarea" rows="6"></textarea>
      <div style="display:flex;gap:8px;justify-content:flex-end;margin-top:8px">
        <button id="cancelEdit" type="button" class="btn" style="background:transparent;border:1px solid var(--muted);color:var(--fg)">Cancel</button>
        <button id="saveEdit" type="button" class="btn">Save</button>
      </div>
    </div>
  </div>
</div>
<footer>
  <a href="/contact">Contact</a> | Idawn™
</footer>
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/dist/umd/supabase.min.js"></script>
<script>
const SUPABASE_URL='https://thdzrkzdkdihjximoalb.supabase.co'
const SUPABASE_KEY='eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InRoZHpya3pka2RpaGp4aW1vYWxiIiwicm9lIjoiYW5vbiIsImlhdCI6MTc2MDI0OTM3MiwiZXhwIjoyMDc1ODI1MzcyfQ.uHpGricbNHVWsndClTd8K7LVRTCzWLF0ziwuGKvOSTw'
const BUCKET='thread_files'
const supabase=supabase.createClient(SUPABASE_URL,SUPABASE_KEY)
function getCookie(n){const c=document.cookie.split('; ').find(r=>r.startsWith(n+'='));if(!c)return null;try{return JSON.parse(decodeURIComponent(c.split('=')[1]))}catch(e){return null}}
function clearCookie(n){document.cookie=n+'=; path=/; max-age=0'}
const esc=s=>String(s||'').replaceAll('&','&amp;').replaceAll('<','&lt;').replaceAll('>','&gt;')
function showStatus(t,timeout=3000){const el=document.getElementById('statusMsg');el.textContent=t;if(timeout)setTimeout(()=>{el.textContent=''},timeout)}
</script>
<script src="/js/leaks-app.js"></script>
</body>
</html>
