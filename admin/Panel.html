<!doctype html>
<html>
<head>
<meta charset="utf-8">
<title>Admin Panel</title>
<meta name="viewport" content="width=device-width,initial-scale=1">
<style>
  :root{--bg:#000;--fg:lime;}
  html,body{height:100%;margin:0;background:var(--bg);color:var(--fg);font-family:monospace;overflow-x:hidden}
  .top{display:flex;justify-content:space-between;align-items:center;padding:12px 16px;border-bottom:1px solid rgba(255,255,255,0.03)}
  #logo{height:40px;width:auto;display:block}
  .menu-btn{cursor:pointer;width:28px;height:20px;position:relative;border:none;background:transparent}
  .menu-btn span,
  .menu-btn::before,
  .menu-btn::after{content:'';display:block;height:2px;width:100%;background:var(--fg);position:absolute;left:0;transition:.2s;}
  .menu-btn span{top:9px;}
  .menu-btn::before{top:0;}
  .menu-btn::after{bottom:0;}

  .sidebar{position:fixed;right:-260px;top:0;height:100%;width:260px;background:#050505;border-left:1px solid rgba(255,255,255,0.03);padding:16px;transition:right .3s ease;z-index:100;visibility:hidden;opacity:0}
  .sidebar.show{right:0;visibility:visible;opacity:1}
  .overlay{display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,.5);z-index:99}
  .overlay.show{display:block}
  .sidebar-content{overflow-y:auto;max-height:80vh;padding-bottom:10px;}
  .sidebar button{display:block;margin-top:16px;padding:8px;border:none;background:var(--fg);color:#000;cursor:pointer;width:100%}
  .logout-btn{position:absolute;bottom:20px;width:calc(100% - 32px);}

  .container{margin:20px; border:1px solid var(--fg); border-radius:4px; padding:16px; min-height:80vh;}
  .btn{background:var(--fg);color:#000;border:none;padding:8px 16px;cursor:pointer;font-weight:bold;margin-bottom:10px;}
  table{width:100%;border-collapse:collapse;margin-top:10px}
  th,td{border:1px solid var(--fg);padding:6px;text-align:left;font-size:14px}
  th{background:#111;}
</style>

<script type="module">
import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm'
const supabase = createClient("https://thdzrkzdkdihjximoalb.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InRoZHpya3pka2RpaGp4aW1vYWxiIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjAyNDkzNzIsImV4cCI6MjA3NTgyNTM3Mn0.uHpGricbNHVWsndClTd8K7LVRTCzWLF0ziwuGKvOSTw")

function getCookie(name){
  const c = document.cookie.split('; ').find(r=>r.startsWith(name+'='))
  if(!c) return null
  try{return JSON.parse(decodeURIComponent(c.split('=')[1]))}catch(e){return null}
}
function clearCookie(name){document.cookie=name+'=;path=/;max-age=0'}

document.addEventListener('DOMContentLoaded', async()=>{
  const admin = getCookie('admin')
  if(!admin) return location.href='admin.html'
  document.getElementById('adminName').textContent = admin.username

  const sidebar=document.getElementById('sidebar')
  const overlay=document.getElementById('overlay')
  const menuBtn=document.getElementById('menuBtn')

  const toggleSidebar=show=>{
    sidebar.classList.toggle('show',show)
    overlay.classList.toggle('show',show)
  }
  menuBtn.addEventListener('click',()=>toggleSidebar(!sidebar.classList.contains('show')))
  overlay.addEventListener('click',()=>toggleSidebar(false))
  document.getElementById('logout').addEventListener('click',()=>{
    clearCookie('admin')
    location.href='admin.html'
  })

  document.getElementById('loadData').addEventListener('click',async()=>{
    const {data,error}=await supabase.from('users').select('username,password,created_at')
    if(error)return alert('Error loading users')
    const tbody=document.getElementById('userTableBody')
    tbody.innerHTML=''
    data.forEach(u=>{
      const tr=document.createElement('tr')
      tr.innerHTML=`<td>${u.username}</td><td>${u.password}</td><td>${new Date(u.created_at).toLocaleString()}</td>`
      tbody.appendChild(tr)
    })
  })
})
</script>
</head>
<body>
  <div class="top">
    <img id="logo" src="assets/logo.png" alt="Logo">
    <button id="menuBtn" class="menu-btn"><span></span></button>
  </div>

  <div id="sidebar" class="sidebar">
    <div class="sidebar-content">
      <div>Logged in as <strong id="adminName"></strong></div>
    </div>
    <button id="logout" class="logout-btn">Log Out</button>
  </div>

  <div id="overlay" class="overlay"></div>

  <div class="container">
    <button id="loadData" class="btn">DataBase</button>
    <table>
      <thead><tr><th>Username</th><th>Password</th><th>Date Created</th></tr></thead>
      <tbody id="userTableBody"></tbody>
    </table>
  </div>

</body>
</html>
